<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Closed_Won_StagePG</fullName>
    <active>true</active>
    <description>If Primary Quote is not approved and buyer accepted, you cannot change a PG opportunity to closed won.</description>
    <errorConditionFormula>AND(

$Setup.byPass__c.ByPass_Validation__c = FALSE,

$Profile.Name = &quot;Standard Ads User Profile&quot;,
ISCHANGED(StageName) ,
ISPICKVAL(StageName, &#39;Closed Won&#39;),
RecordType.DeveloperName = $Label.OPP_RECORDTYPEDEVNAME_PROGRAMMATIC,

Primary_Quote__r.RecordType.Name = &#39;PG PMP Quote&#39;,
Primary_Quote__r.Buyer_Accepted__c = FALSE
)</errorConditionFormula>
    <errorMessage>Cannot change stage to Closed Won if Primary Quote is not approved &amp; buyer accepted</errorMessage>
</ValidationRule>
